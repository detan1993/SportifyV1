<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./template/staffMasterPage.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="center">


        <h:outputScript library = "js" name = "help.js"   />

        <h:outputStylesheet library="css" name="test.css"/>

        <p style="color:orange; font-size:1.3em;"> 
            DASHBOARD PAGE </p>

        <h:form id="dashboardParentForm">

            <p:tabView id="dashboardTab" dynamic="true" cache="true" effect="fold">


                <p:tab title="Overview">

                    <div style="margin-top: 25px;">
                        <h:form id="selectDateForm">
                            <p:growl id="msgs" showDetail="true" />
                            <h:panelGrid columns="5" cellpadding="5">
                                <p:outputLabel style="color:white;" for="fromDate" value="From" />
                                <p:calendar id="fromDate" value="#{dashboardManagedBean.salesDate}"  maxdate="#{dashboardManagedBean.currentDate}" />
                                <p:outputLabel style="color:white;" for="toDate" value="To" />
                                <p:calendar id="toDate"  value="#{dashboardManagedBean.salesDate}"  maxdate="#{dashboardManagedBean.currentDate}" />
                                <p:commandButton  update="msgs" actionListener="#{dashboardManagedBean.click}" icon="ui-icon-search" />
                            </h:panelGrid>

                        </h:form>

                    </div>

                    <div style="height:100%; margin-top: 25px;">
                        <h:form>
                            <p:growl id="msgs" showDetail="true" />

                            <!-- line chart state here !-->

                        </h:form>

                    </div>


                </p:tab>

                <p:tab title="Customer Report">

                    <div style="margin-top: 25px;">
                        <h:form id="selectDateTopCustomerForm">
                            <p:growl id="msgsTopSales" showDetail="true" />
                            <h:panelGrid columns="5" cellpadding="5">
                                <p:outputLabel style="color:white;" for="customerFromDate" value="From" />
                                <p:calendar id="customerFromDate"  value="#{dashboardManagedBean.customerFrom}" beforeShowDay="disableFromDays"  pattern="dd/MMM/yyyy" maxdate="#{dashboardManagedBean.currentDate}" />
                                <p:outputLabel style="color:white;"   for="customerToDate" value="To" />
                                <p:calendar id="customerToDate" value="#{dashboardManagedBean.customerTo}" beforeShowDay="disableToDays"  pattern="dd/MMM/yyyy"   maxdate="#{dashboardManagedBean.currentDate}" />
                                <p:commandButton process="selectDateTopCustomerForm" update="msgsTopSales #{p:component('topCustomerTable')} " actionListener="#{dashboardManagedBean.searchTopCustomer}" icon="ui-icon-search" />
                            </h:panelGrid>

                        </h:form>


                    </div>

                    <div>

                        <h:form id="topCustomerFilter">
                            <p:growl id="topMsg" showDetail="true" />
                            <h:panelGrid columns="2" cellpadding="5">

                                <p:outputLabel for="customerRankFilter" style="color:white;" value="Rank By: " />
                                <p:selectOneMenu id="customerRankFilter" value="#{dashboardManagedBean.selectFilterTopCustomer}" style="width:150px">
                                    <f:selectItem itemLabel="Total Purchases(S$)" itemValue ="TP" />
                                    <f:selectItem itemLabel="Total No. of Purchases" itemValue ="TQTY" />
                                    <f:selectItem itemLabel="Avg Purchases" itemValue ="AP" />
                                    <p:ajax  event="change" update="#{p:component('topCustomerTable')}" listener="#{dashboardManagedBean.onTopCustomerFilterChange}"/>
                                </p:selectOneMenu>


                            </h:panelGrid>


                        </h:form>
                    </div>

                    <div style="margin-top: 25px;">

                        <p:dataTable id="topCustomerTable" var="customer" value="#{dashboardManagedBean.topCustomers}">
                            <f:facet name="header">
                                Top 10 Customer
                            </f:facet>
                            <p:column headerText="Rank">
                                <h:outputText value="#{customer.rank}"/>
                            </p:column>
                            <p:column headerText="Email">
                                <h:outputText styleClass="topCustomerDiv"  value="#{customer.email}" />
                            </p:column>
                            <p:column headerText="Total Purchase($)">
                                <h:outputText styleClass="topCustomerDiv"  value="#{customer.totalPurchase}" />
                            </p:column>
                            <p:column headerText="Total No of Purchase">
                                <h:outputText styleClass="topCustomerDiv"  value="#{customer.totalNoOfPurchase}" />
                            </p:column>
                            <p:column headerText="Avg Purchase per Transaction">
                                <h:outputText styleClass="topCustomerDiv"  value="#{customer.averagePurchasePerTransaction}" />
                            </p:column>
                            <p:column style="width:32px;text-align: center">
                                <p:commandButton update="#{p:component('formViewTopCustomer')}" oncomplete="PF('customerDialog').show()" icon="ui-icon-search" title="View">
                                    <f:setPropertyActionListener value="#{customer}" target="#{dashboardManagedBean.selectedCustomer}" />
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>


                        <h:form id="formViewTopCustomer">

                            <p:dialog id="customerDialog" appendTo="@(body)" widgetVar="customerDialog" header="Profile" modal="true" height="300" width="480" closable="true" resizable="false">
                                <p:outputPanel id="carDetail" style="text-align:center;">
                                    <p:panelGrid  columns="2" rendered="#{not empty dashboardManagedBean.selectedProducts}" columnClasses="label,value">

                                        <h:outputText value="Name:" />
                                        <h:outputText value="#{dashboardManagedBean.selectedCustomer.fullName}" />

                                        <h:outputText value="Birthday:" />
                                        <h:outputText value="#{dashboardManagedBean.selectedCustomer.accountCreated}" />

                                        <h:outputText value="Loyalty Point:" />
                                        <h:outputText value="#{dashboardManagedBean.selectedCustomer.loyaltyPoint}" />

                                        <h:outputText value="Total Purchase ($) By Team:" />


                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:dialog>
                        </h:form>


                    </div>





                </p:tab>

                <p:tab title="Product Report">

                    <div style="margin-top: 25px;">
                        <h:form id="selectDateTopProductForm">

                            <h:panelGrid columns="5" cellpadding="5">
                                <p:outputLabel style="color:white;" for="productFromDate" value="From" />
                                <p:calendar id="productFromDate" value="#{dashboardManagedBean.salesDate}"  maxdate="#{dashboardManagedBean.currentDate}" />
                                <p:outputLabel style="color:white;" for="productToDate" value="To" />
                                <p:calendar id="productToDate"  value="#{dashboardManagedBean.salesDate}"  maxdate="#{dashboardManagedBean.currentDate}" />
                                <p:commandButton actionListener="#{dashboardManagedBean.click}" icon="ui-icon-search" />
                            </h:panelGrid>

                        </h:form>

                    </div>

                    <div>

                        <h:form id="topProductFilter">
                            <p:growl id="topMsg" showDetail="true" />
                            <h:panelGrid columns="2" cellpadding="5">

                                <p:outputLabel for="productRankFilter" style="color:white;" value="Rank By: " />
                                <p:selectOneMenu id="productRankFilter" value="haha" style="width:150px">
                                    <f:selectItems value="#{dashboardManagedBean.totalSalesByTeamFilter}" />
                                </p:selectOneMenu>
                            </h:panelGrid>


                        </h:form>
                    </div>

                </p:tab>



            </p:tabView>

        </h:form>

    </ui:define>

</ui:composition>
